<% content_for :title, "Subjunct" %>
<% content_for :description, "Share your secrets." %>

<script>
  posts = <%= @posts.to_json.html_safe -%>;
</script>

<div id="banner">
  <div class="container">
    <form name="composeForm" class="compose-form" data-ng-controller="ComposeController" data-ng-submit="submit($event)" data-ng-init="show_errors=false">
      <div class="row compose-form-inputs">
        <div class="span5 offset1">
          <h2>Write a secret message</h2>
          <p><textarea name="message" class="message" placeholder="Secret message" required="required" data-ng-model="message"></textarea></p>
        </div>
        <div class="span5">
          <h2>Guarded by secret knowledge</h2>
          <p><textarea name="question" class="question" placeholder="Security question" required="required" data-ng-model="question"></textarea></p>
          <p><textarea name="answer" class="answer" placeholder="Answer" required="required" data-ng-model="answer"></textarea></p>
        </div>
      </div>
      <div class="row compose-form-submit">
        <div class="span5 offset1 phone-hidden">
          <p class="error-message">
            <span data-ng-show="show_errors && error_message() != null">{{error_message()}}</span>
            <span data-ng-show="!show_errors || error_message() == null">&nbsp;</span>
          </p>
        </div>
        <div class="span5">
          <p class="right">
            <span class="counter">
              <span data-ng-class="{ 'error-count': bad_count(question, max_question) }">{{remaining(question, max_question)}}</span> /
              <span data-ng-class="{ 'error-count': bad_count(answer, max_answer) }">{{remaining(answer, max_answer)}}</span> /
              <span data-ng-class="{ 'error-count': bad_count(message, max_message) }">{{remaining(message, max_message)}}</span>
            </span>
            <span class="button" ng-class="{ disabled: submitted }" data-ng-mouseover="show_errors=true" data-ng-mouseout="show_errors=false" data-ng-click="submit($event)">Subjunct &nbsp;<i class="fa fa-angle-double-right"></i></span>
            <input type="submit" class="hidden" value="Subjunct" />
          </p>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="container js-masonry" id="cards" data-ng-controller="PostsController" data-masonry-options='{ "itemSelector": ".card", "gutter": 12, "transitionDuration": "0s" }' >
  <div class="card" data-ng-repeat="post in posts" data-ng-click="expand(post, $event)" data-ng-class="{true: 'expanded', false: 'contracted'}[post.expanded]">
    <div class="card-question">{{post.question}}</div>
    <div class="card-details clearfix">
      <div class="card-date">
        <i class="fa fa-clock-o"></i> {{post.date}}
      </div>
      <div class="card-options">
        <a data-ng-show="!post.expanded" href="#" data-ng-click="expand(post, $event); $event.stopPropagation(); $event.preventDefault();"><i class="fa fa-caret-down"></i></a>
        <a data-ng-show="post.expanded" href="#" data-ng-click="contract(post, $event);  $event.stopPropagation(); $event.preventDefault();"><i class="fa fa-caret-up"></i></a>
        &nbsp;
        <a href="/{{post.id}}" data-ng-click="$event.stopPropagation()"><i class="fa fa-link"></i></a>
      </div>
    </div>
    <form class="answer-form" data-ng-show="post.expanded">
      <input type="text" name="answer" class="answer" placeholder="Answer" required="required" />
    </form>
  </div>
</div>
